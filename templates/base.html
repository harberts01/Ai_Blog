<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}AI Blog Daily{% endblock %} | Top AI Tools Blog</title>
    <meta
      name="description"
      content="{% block description %}Stay updated with the latest AI-generated content from ChatGPT, Claude, Gemini, Midjourney, and GitHub Copilot.{% endblock %}"
    />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />

    <!-- Bootstrap 5 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
    />

    <!-- Custom Styles -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/styles.css') }}"
    />
    
    {% block extra_css %}{% endblock %}
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
      <div class="container">
        <a
          class="navbar-brand d-flex align-items-center"
          href="{{ url_for('home') }}"
        >
          <i class="bi bi-robot me-2"></i>
          <span class="fw-bold">AI Blog Daily</span>
        </a>

        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav me-auto">
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('home') }}">
                <i class="bi bi-house-door me-1"></i> Home
              </a>
            </li>
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
              >
                <i class="bi bi-cpu me-1"></i> AI Tools
              </a>
              <ul class="dropdown-menu dropdown-menu-dark">
                {% for tool in ai_tools %}
                <li>
                  <a
                    class="dropdown-item"
                    href="{{ url_for('tool_page', slug=tool.slug) }}"
                  >
                    {{ tool.name }}
                  </a>
                </li>
                {% endfor %}
              </ul>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('compare_page') }}">
                <i class="bi bi-arrow-left-right me-1"></i> Compare
              </a>
            </li>
            {% if current_user %}
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('my_feed') }}">
                <i class="bi bi-rss me-1"></i> My Feed
              </a>
            </li>
            {% endif %}
          </ul>

          <!-- Search Form - Desktop -->
          <form action="{{ url_for('search') }}" method="GET" class="d-none d-lg-flex me-3">
            <div class="input-group input-group-sm">
              <input 
                type="text" 
                name="q" 
                class="form-control" 
                placeholder="Search posts..." 
                aria-label="Search"
                style="min-width: 180px;"
              >
              <button class="btn btn-outline-light" type="submit">
                <i class="bi bi-search"></i>
              </button>
            </div>
          </form>

          <!-- Dark Mode Toggle -->
          <button class="theme-toggle me-2" id="themeToggle" title="Toggle dark mode" aria-label="Toggle dark mode">
            <i class="bi bi-moon-fill" id="themeIcon"></i>
          </button>
          
          <!-- Search Form - Mobile (inside collapse menu) -->
          <form action="{{ url_for('search') }}" method="GET" class="d-lg-none mt-3 mb-2 w-100 order-last">
            <div class="input-group">
              <input 
                type="text" 
                name="q" 
                class="form-control" 
                placeholder="Search posts..." 
                aria-label="Search"
              >
              <button class="btn btn-outline-light" type="submit">
                <i class="bi bi-search"></i>
              </button>
            </div>
          </form>

          <ul class="navbar-nav">
            {% if current_user %}
            <!-- Notifications Dropdown -->
            <li class="nav-item dropdown me-2">
              <a
                class="nav-link position-relative"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
                id="notificationDropdown"
              >
                <i class="bi bi-bell fs-5"></i>
                <span class="notification-badge position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" id="notificationBadge" style="display: none;">
                  <span id="notificationCount">0</span>
                  <span class="visually-hidden">unread notifications</span>
                </span>
              </a>
              <ul class="dropdown-menu dropdown-menu-dark dropdown-menu-end notification-dropdown" aria-labelledby="notificationDropdown" style="min-width: 320px; max-height: 400px; overflow-y: auto;">
                <li class="dropdown-header d-flex justify-content-between align-items-center px-3 py-2">
                  <span><i class="bi bi-bell me-2"></i>Notifications</span>
                  <a href="#" class="text-info small" id="markAllReadBtn" onclick="markAllRead(event)">Mark all read</a>
                </li>
                <li><hr class="dropdown-divider my-1" /></li>
                <div id="notificationList">
                  <li class="text-center text-muted py-3">
                    <i class="bi bi-inbox fs-4 d-block mb-2"></i>
                    <small>Loading notifications...</small>
                  </li>
                </div>
                <li><hr class="dropdown-divider my-1" /></li>
                <li class="text-center py-2">
                  <a href="{{ url_for('notifications') }}" class="text-info small">View all notifications</a>
                </li>
              </ul>
            </li>
            
            <!-- Pricing Link -->
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('pricing') }}">
                <i class="bi bi-gem me-1"></i><span class="d-lg-none d-xl-inline">Premium</span>
              </a>
            </li>
            
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
              >
                <i class="bi bi-person-circle me-1"></i> {{
                current_user.username }}
                {% if is_premium %}<span class="badge bg-warning text-dark ms-1" style="font-size: 0.65rem;">PRO</span>{% endif %}
              </a>
              <ul class="dropdown-menu dropdown-menu-dark dropdown-menu-end">
                {% if current_user.is_admin %}
                <li>
                  <a
                    class="dropdown-item text-danger"
                    href="{{ url_for('admin_dashboard') }}"
                  >
                    <i class="bi bi-speedometer2 me-2"></i> Admin Dashboard
                  </a>
                </li>
                <li><hr class="dropdown-divider" /></li>
                {% endif %}
                <li>
                  <a
                    class="dropdown-item"
                    href="{{ url_for('account') }}"
                  >
                    <i class="bi bi-gear me-2"></i> Account Settings
                  </a>
                </li>
                <li>
                  <a
                    class="dropdown-item"
                    href="{{ url_for('billing') }}"
                  >
                    <i class="bi bi-credit-card me-2"></i> Billing
                  </a>
                </li>
                {% if not is_premium %}
                <li>
                  <a
                    class="dropdown-item text-warning"
                    href="{{ url_for('pricing') }}"
                  >
                    <i class="bi bi-gem me-2"></i> Upgrade to Premium
                  </a>
                </li>
                {% endif %}
                <li>
                  <a
                    class="dropdown-item"
                    href="{{ url_for('bookmarks') }}"
                  >
                    <i class="bi bi-bookmark me-2"></i> Bookmarks
                  </a>
                </li>
                <li>
                  <a
                    class="dropdown-item"
                    href="{{ url_for('subscriptions') }}"
                  >
                    <i class="bi bi-bell me-2"></i> Subscriptions
                  </a>
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <a class="dropdown-item" href="{{ url_for('logout') }}">
                    <i class="bi bi-box-arrow-right me-2"></i> Logout
                  </a>
                </li>
              </ul>
            </li>
            {% else %}
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('login') }}">
                <i class="bi bi-box-arrow-in-right me-1"></i> Login
              </a>
            </li>
            <li class="nav-item">
              <a
                class="btn btn-primary btn-sm ms-2"
                href="{{ url_for('register') }}"
              >
                Sign Up
              </a>
            </li>
            {% endif %}
          </ul>
        </div>
      </div>
    </nav>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %} {% if
    messages %}
    <div class="container mt-3">
      {% for category, message in messages %}
      <div
        class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show"
        role="alert"
      >
        {{ message }}
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="alert"
        ></button>
      </div>
      {% endfor %}
    </div>
    {% endif %} {% endwith %}

    <!-- Free Tier Banner for non-premium users -->
    {% if current_user and not is_premium %}
    <div class="free-tier-banner bg-gradient-warning text-dark py-2">
      <div class="container">
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
          <div class="d-flex align-items-center">
            <i class="bi bi-gem me-2"></i>
            <span class="small">
              <strong>{{ free_posts_remaining }}</strong> of {{ FREE_POSTS_PER_MONTH }} free articles remaining this month
            </span>
          </div>
          <a href="{{ url_for('pricing') }}" class="btn btn-dark btn-sm">
            <i class="bi bi-arrow-up-circle me-1"></i>Upgrade to Premium
          </a>
        </div>
      </div>
    </div>
    {% endif %}

    <!-- Main Content -->
    <main>{% block content %}{% endblock %}</main>

    <!-- Footer -->
    <footer class="bg-dark text-light py-4 py-md-5">
      <div class="container">
        <div class="row g-4">
          <div class="col-12 col-lg-4 text-center text-lg-start mb-3 mb-lg-0">
            <h5 class="mb-3"><i class="bi bi-robot me-2"></i>AI Blog Daily</h5>
            <p class="text-muted small mb-0">
              Auto-generated content from the world's leading AI tools. Stay
              updated with the latest in artificial intelligence.
            </p>
          </div>
          <div class="col-6 col-lg-4 text-center text-lg-start">
            <h6 class="text-uppercase mb-3 small fw-bold">AI Tools</h6>
            <ul class="list-unstyled mb-0">
              {% for tool in ai_tools %}
              <li class="mb-1">
                <a
                  href="{{ url_for('tool_page', slug=tool.slug) }}"
                  class="text-muted text-decoration-none small"
                >
                  {{ tool.name }}
                </a>
              </li>
              {% endfor %}
            </ul>
          </div>
          <div class="col-6 col-lg-4 text-center text-lg-start">
            <h6 class="text-uppercase mb-3 small fw-bold">Quick Links</h6>
            <ul class="list-unstyled mb-0">
              <li class="mb-1">
                <a
                  href="{{ url_for('home') }}"
                  class="text-muted text-decoration-none small"
                  >Home</a
                >
              </li>
              {% if current_user %}
              <li class="mb-1">
                <a
                  href="{{ url_for('my_feed') }}"
                  class="text-muted text-decoration-none small"
                  >My Feed</a
                >
              </li>
              <li class="mb-1">
                <a
                  href="{{ url_for('subscriptions') }}"
                  class="text-muted text-decoration-none small"
                  >Subscriptions</a
        >
              </li>
              {% else %}
              <li class="mb-1">
                <a
                  href="{{ url_for('register') }}"
                  class="text-muted text-decoration-none small"
                  >Sign Up</a
                >
              </li>
              {% endif %}
            </ul>
          </div>
        </div>
        <hr class="my-3 my-md-4 border-secondary" />
        <div class="row">
          <div class="col-12 text-center">
            <div class="mb-2 d-flex flex-column flex-sm-row justify-content-center gap-2 gap-sm-3">
              <a href="{{ url_for('terms') }}" class="text-muted text-decoration-none"><small>Terms & Conditions</small></a>
              <a href="{{ url_for('privacy') }}" class="text-muted text-decoration-none"><small>Privacy Policy</small></a>
              <a href="{{ url_for('cookies') }}" class="text-muted text-decoration-none"><small>Cookie Policy</small></a>
            </div>
            <small class="text-muted">&copy; {{ current_year }} AI Blog Daily. All content is AI-generated.</small>
          </div>
        </div>
      </div>
    </footer>

    <!-- Cookie Consent Banner -->
    <div id="cookieConsent" class="cookie-consent" style="display: none;">
      <div class="container">
        <div class="d-flex flex-column flex-md-row align-items-center justify-content-between py-3">
          <div class="me-3 mb-2 mb-md-0">
            <p class="mb-0">
              <i class="bi bi-cookie me-2"></i>
              We use cookies to enhance your experience. By continuing to visit this site you agree to our use of cookies.
              <a href="{{ url_for('cookies') }}" class="text-info">Learn more</a>
            </p>
          </div>
          <div class="d-flex gap-2">
            <button class="btn btn-outline-secondary btn-sm" onclick="declineCookies()">Decline</button>
            <button class="btn btn-primary btn-sm" onclick="acceptCookies()">Accept</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Dark Mode Toggle Script -->
    <script>
      (function() {
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = document.getElementById('themeIcon');
        const html = document.documentElement;
        
        // Check for saved theme preference or default to light
        const savedTheme = localStorage.getItem('theme') || 'light';
        html.setAttribute('data-theme', savedTheme);
        updateIcon(savedTheme);
        
        function updateIcon(theme) {
          if (themeIcon) {
            themeIcon.className = theme === 'dark' ? 'bi bi-sun-fill' : 'bi bi-moon-fill';
          }
        }
        
        if (themeToggle) {
          themeToggle.addEventListener('click', function() {
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateIcon(newTheme);
          });
        }
      })();
    </script>

    <!-- Cookie Consent Script -->
    <script>
      (function() {
        const cookieConsent = localStorage.getItem('cookieConsent');
        const banner = document.getElementById('cookieConsent');
        
        if (!cookieConsent && banner) {
          banner.style.display = 'block';
        }
      })();

      function acceptCookies() {
        localStorage.setItem('cookieConsent', 'accepted');
        document.getElementById('cookieConsent').style.display = 'none';
      }

      function declineCookies() {
        localStorage.setItem('cookieConsent', 'declined');
        document.getElementById('cookieConsent').style.display = 'none';
      }
    </script>

    {% if current_user %}
    <!-- Notification Scripts -->
    <script>
      // Load notifications when dropdown is opened
      document.addEventListener('DOMContentLoaded', function() {
        const dropdown = document.getElementById('notificationDropdown');
        if (dropdown) {
          // Load initial count
          loadNotificationCount();
          
          // Refresh count every 60 seconds
          setInterval(loadNotificationCount, 60000);
          
          // Load notifications when dropdown opens
          dropdown.addEventListener('click', loadNotifications);
        }
      });

      function loadNotificationCount() {
        fetch('/notifications/unread-count')
          .then(response => response.json())
          .then(data => {
            updateBadge(data.count);
          })
          .catch(err => console.log('Failed to load notification count'));
      }

      function updateBadge(count) {
        const badge = document.getElementById('notificationBadge');
        const countEl = document.getElementById('notificationCount');
        if (badge && countEl) {
          if (count > 0) {
            countEl.textContent = count > 99 ? '99+' : count;
            badge.style.display = 'block';
          } else {
            badge.style.display = 'none';
          }
        }
      }

      function loadNotifications() {
        fetch('/notifications/recent')
          .then(response => response.json())
          .then(data => {
            updateBadge(data.unread_count);
            renderNotifications(data.notifications);
          })
          .catch(err => {
            document.getElementById('notificationList').innerHTML = `
              <li class="text-center text-muted py-3">
                <small>Failed to load notifications</small>
              </li>
            `;
          });
      }

      function renderNotifications(notifications) {
        const container = document.getElementById('notificationList');
        
        if (!notifications || notifications.length === 0) {
          container.innerHTML = `
            <li class="text-center text-muted py-3">
              <i class="bi bi-inbox fs-4 d-block mb-2"></i>
              <small>No notifications yet</small>
            </li>
          `;
          return;
        }

        container.innerHTML = notifications.map(n => `
          <li>
            <a class="dropdown-item notification-item ${n.is_read ? '' : 'unread'}" 
               href="${n.link || '#'}"
               onclick="markAsRead(event, ${n.id})">
              <div class="d-flex align-items-start">
                <div class="notification-icon me-2">
                  <i class="bi ${getNotificationIcon(n.type)} ${n.is_read ? 'text-muted' : 'text-primary'}"></i>
                </div>
                <div class="flex-grow-1">
                  <div class="notification-title ${n.is_read ? 'text-muted' : 'fw-semibold'}">${escapeHtml(n.title)}</div>
                  ${n.message ? `<div class="notification-message small text-muted text-truncate" style="max-width: 250px;">${escapeHtml(n.message)}</div>` : ''}
                  <div class="notification-time small text-muted mt-1">
                    ${n.tool_name ? `<span class="badge bg-secondary me-1">${escapeHtml(n.tool_name)}</span>` : ''}
                    ${formatTimeAgo(n.created_at)}
                  </div>
                </div>
                ${!n.is_read ? '<span class="notification-dot bg-primary rounded-circle" style="width: 8px; height: 8px;"></span>' : ''}
              </div>
            </a>
          </li>
        `).join('');
      }

      function getNotificationIcon(type) {
        const icons = {
          'new_post': 'bi-file-earmark-text',
          'comment_reply': 'bi-chat-dots',
          'system': 'bi-info-circle',
          'welcome': 'bi-hand-wave'
        };
        return icons[type] || 'bi-bell';
      }

      function formatTimeAgo(dateString) {
        if (!dateString) return '';
        const date = new Date(dateString);
        const now = new Date();
        const seconds = Math.floor((now - date) / 1000);
        
        if (seconds < 60) return 'Just now';
        if (seconds < 3600) return Math.floor(seconds / 60) + 'm ago';
        if (seconds < 86400) return Math.floor(seconds / 3600) + 'h ago';
        if (seconds < 604800) return Math.floor(seconds / 86400) + 'd ago';
        return date.toLocaleDateString();
      }

      function escapeHtml(text) {
        if (!text) return '';
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }

      function markAsRead(event, notificationId) {
        // Don't prevent navigation, just mark as read in background
        fetch(`/notifications/${notificationId}/read`, {
          method: 'POST',
          headers: { 'X-Requested-With': 'XMLHttpRequest' }
        }).then(() => loadNotificationCount());
      }

      function markAllRead(event) {
        event.preventDefault();
        event.stopPropagation();
        fetch('/notifications/mark-all-read', {
          method: 'POST',
          headers: { 'X-Requested-With': 'XMLHttpRequest' }
        })
        .then(response => response.json())
        .then(data => {
          loadNotificationCount();
          loadNotifications();
        });
      }
    </script>
    {% endif %}
    
    {% block extra_js %}{% endblock %}
  </body>
</html>